
<!-- 
#################################################
# HEAD - FOR ALL PAGES
#################################################
 -->

<!doctype html>
<html lang="en">
<head>  
    
  <!-- META -->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="author" content="Martin Alfaro">
  

  <!-- FRANKLIN DEFINED - LATEX AND CODE HIGHLIGHTS -->
   <!-- HERE WE ADD ANY CSS ELEMENT WE WANT TO ADD
(don't confuse head with header, head applies globally) -->

<link rel="stylesheet" href="/blog/libs/katex/katex.min.css">
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/aaaakshat/cm-web-fonts@latest/fonts.css"></link>

<link rel="stylesheet" 
href="https://fonts.googleapis.com/css?family=Open+Sans"></link>
<!-- Montserrat|Roboto|Lato|Raleway|Work+Sans|Raleway -->     
   <link rel="stylesheet" href="/blog/libs/highlight/styles/vs_myversion.css">
   

  <link rel="stylesheet" href="/blog/css/bootstrap.min.css">    
  <style>
.section-bg-color {
  background-color: rgba(63, 99, 136, 0.08);
}

footer a {
  color: cornflowerblue;
}



  header {
    margin-top: 0px !important;
  }



header .jumbotron {
  background-image: linear-gradient(to right, black, rgb(0, 0, 0) 10%, rgb(63,99,136) 55%, rgb(63,99,136));;
  background-repeat: no-repeat;  
  background-size: 100%;  
}
</style>
  <link rel="stylesheet" href="/blog/css/custom.css">

    
<!-- WINDOWS TAB -->
  <title>T.E.C.H. - Martin Alfaro</title>
  <link rel="icon" type="image/png"  href="/blog/assets/pics_html/dog_home.png">
    

</head>
<!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-K96JNP7PKB"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-K96JNP7PKB');
    </script>
<!-- end of google tag -->


<body id="page-top">
  <!-- HERE WE ADD ALL THE HTML ELEMENTS (PAGES) WE WANT TO ADD TO THE SITE, FOR INSTANCE THE SIDEBAR -->



<!-- 
#################################################
# FOR EACH SPECIFIC PAFE
#################################################
 -->




<!-- /* ================================================================= 
                      FOOTNOTES with TOOLTIP
================================================================= */ 
<style>

.supr {
  vertical-align: 80%;
  font-size: 75%;
  line-height: 1; 
}
.footn {
  position: relative;
  display: inline-block;
  margin-left:-0.6em;
  margin-right:0;
  color: #2669DD;
  text-decoration: underline;  
  }

.footn .footn_text {
  font-size: 125%;
  visibility: hidden;  
  width: max-content; max-width: 500px;
  text-align: justify;  
  text-justify: inter-word;
  text-indent: 0%;
  line-height: 1.5;
  background-color:#282c34;
  color: #e0e4eb;
  border-radius: 6px;
  padding: 5px 12px 5px 12px;    
  
  /* Position the hovering_foot */
  position: absolute;
  z-index: 1;
  top: 100%;
  left: -125px;
  
}

.footn:hover .footn_text {
  visibility: visible;   
}

.footn a{
  color: #7b9fdd;
  }

.footn a:hover{
  color: #a1b6dbb2;
}
</style>

/* in case we don't want whitespace due to overflow  */
/* 
.footn .footn_text {display:none;}
.footn:hover .footn_text {
  display:block;   
} */ -->



<!-- <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script> 

<script>
	$('a[rel="footnote"]').hover(
		function(){
			$($(this).attr('href')).addClass('hovering');
		},
		function(){
			$($(this).attr('href')).removeClass('hovering');
		}
	);
</script> -->

<style>

.footn {
	  position: relative;
	  display: inline-block;
	  margin-left: -0.6em;
	  margin-right: 0;
	  color: #2669DD;
	  text-decoration: underline;
	}

	.supr {
	  vertical-align: 80%;
	  font-size: 75%;
	  line-height: 1; 
	}
	
	
	
	.footn .footn_text {	
	  font-size: 125%;
	  visibility: hidden;  	  
	  text-align: justify;  
	  text-justify: inter-word;
	  text-indent: 0%;
	  line-height: 1.5;
	  background-color: #282c34;
	  color: #e0e4eb;
	  border-radius: 6px;
	  padding: 5px 12px 5px 12px;
	
	  /* Position the hovering_foot */
	  position: absolute;
	  z-index: 1;
	  bottom: 100%;	  
	  right:0;
	}
	
	.footn .footn_text.left {
		left:0;		
		width: max-content;
	  	max-width: 500px;
	}

	.footn .footn_text.right {	  
		right: 0;	  
		width: max-content;
	  max-width: 500px;
	}
	
	.footn:hover .footn_text {
	  visibility: visible;   
	}
	
	.footn a{
	  color: #7b9fdd;
	}
	
	.footn a:hover{
	  color: #a1b6dbb2;
	}
		
  </style>
  
  
  <!-- Include the jQuery library and add the script to handle the hover effect -->
  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script>

  
  <script>
$(document).ready(function() {
  $('.footn.supr').hover(
    function() {
      var footnoteText = $(this).find('.footn_text');
      var sentence = $(this).closest('p');
	  var sentenceWidth = sentence.width();
    //   var footnoteTextLeft = footnoteText.offset().left - sentence.offset().left;
    //   var isRightAligned = footnoteTextLeft > sentenceWidth / 2;

	  var footnoteTextLeft = footnoteText.offset().left - sentence.offset().left;
      var isRightAligned = footnoteTextLeft > sentenceWidth / 2;

     // Remove existing alignment classes
     footnoteText.removeClass('left right');

      // Add the appropriate alignment class
      if (isRightAligned) {
        footnoteText.addClass('right');
      } else {
        footnoteText.addClass('left');
      }

      // Add the "hovering" class to the footnote text
      footnoteText.addClass('hovering');
    },
    function() {
      // Remove the "hovering" class from the footnote text
      $(this).find('.footn_text').removeClass('hovering');
	  $(this).find('.footn_text').removeClass('left right');
    }
  );
});

  </script>



<!-- FOR MOBILE PHONES -->
<style>
	@media (max-width: 768px) {
		.footn .footn_text.left {
		left:0;		
		width: max-content;
	  	max-width: 200px;
	}

	.footn .footn_text.right {	  
		right: 0;	  
		width: max-content;
		max-width: 200px;
	}	}
</style>


<!-- <script>
	// Create a media query to match the condition (max-width: 768px)
	var mediaQuery = window.matchMedia('(max-width: 768px)');

	// Define a callback function to execute when the media query matches
	var mediaQueryHandler = function (event) {
		if (event.matches) {
			// Code to be executed when the media query matches (screen width <= 768px)
			$(document).ready(function () {
				$('.footn.supr').hover(
					function () {
						var footnoteText = $(this).find('.footn_text');
						var sentence = $(this).closest('p');
						var sentenceWidth = sentence.width();
						var footnoteTextLeft = footnoteText.offset().left - sentence.offset().left;
						var isRightAligned = footnoteTextLeft > sentenceWidth / 2;

						// Remove existing alignment classes
						footnoteText.removeClass('left right');

						// Add the appropriate alignment class
						if (isRightAligned) {
							footnoteText.addClass('right');
						} else {
							footnoteText.addClass('left');
						}

						// Add the "hovering" class to the footnote text
						footnoteText.addClass('hovering');
					},
					function () {
						// Remove the "hovering" class from the footnote text
						$(this).find('.footn_text').removeClass('hovering');
					}
				);
			});
		}
	};

	// Add the event listener to the media query
	mediaQuery.addListener(mediaQueryHandler);

	// Call the handler once at the beginning to check the initial state
	mediaQueryHandler(mediaQuery);

</script> --> 
<link href="https://fonts.cdnfonts.com/css/cascadia-mono" rel="stylesheet">

<style>

/*  */


  /* ================================================================= 
                                CODE FORMAT  
  ================================================================= */ 
  /* output_box_copied is LEGACY, we should delete in NEW FILES!!!!!! */


  /* USEFUL TO CHANGE THE MARGINS OF THE CODE*/
  pre {
    position: relative;  /* necessary for "copy" button */
    overflow: hidden;
  }

    /* FOR WARNING, REMARK, AND MODALS 
  .warning pre, .remark pre, .modal-body pre {
    margin-bottom: 1.2em;
  }    */
       
    /* FOR INLINE CODE, WRITTEN WITHIN THE TEXT*/
  code {  
    background-color: rgb(209, 217, 224);         /*rgb(199, 223, 236);*/
    color           : black;
    text-indent     : 0%;
    padding-top     : 0.1em;
    padding-bottom  : 0.1em;
    padding-left    : 0.3em;
    padding-right   : 0.3em;
    vertical-align  : 0.05em;
    border          : 1px solid rgb(0, 16, 41);
  }

  .julia_repl_NoFormat code, .mixed_output_NoFormat code {  
    background-color: rgb(82, 120, 104);         /*rgb(199, 223, 236);*/
    color           : #DCDCDC;
    border          : 1px solid rgb(82, 120, 104);    
  }


  
  
  
  
    
  /* COPY BUTTON */
  /* version blue, conceived by use of code only */
   
  .copy-button {
    cursor        : pointer;
    border        : none;
    font-size     : 12px;
    text-transform: lowercase;
    font-weight   : 500;
    padding       : 0px 10px 2px;
      /* background-color:   #3f6b4b; */
    background-color: rgb(63,99,136);
    position        : absolute;
    top             : 0px;
    right           : 12px;            /*Button shows in the right side of block*/
    text-align      : center;
    color           : #ffffff;
    margin-top      : 0;
    z-index         : 1;
  }
  
  .copy-button:hover{
    outline         : none;
    background-color: rgb(84, 131, 179);
  }
  .copy-button:focus {
    outline         : none;
    background-color: rgb(50, 78, 107);
  }
  
  



/* ================================================================= 
                      BASIC FORMAT FOR OUTPUTS
  ================================================================= */ 
  /* to not collapse with the copy button and `pre` */
.akin_to_pre {
  white-space: pre-wrap;
  font-family: "Consolas";
}

  /* NoFormat for julia repl - no margins or paddings, just colors, fonts, etc */
.julia_repl_NoFormat{  
    font-family     : "Consolas";
    font-size       : 95%;
    color           : #DCDCDC;
    border          : none;
    background-color: rgb(1, 59,31);
    margin          : 0;
    padding         : 0;
}

.julia_repl_NoFormat .akin_to_pre{  
  line-height: 1.35;
  color      : #DCDCDC;
  font-size  : 100%;
  margin     : 0;
  padding    : 0;
}


/* NoFormat for \output{} - no margins or paddings, just colors, fonts, etc  */
.franklin_output_NoFormat{
    font-family     : "Consolas";    
    font-size       : 95%;
    margin          : 0;
    padding         : 0;
    background-color: rgb(1, 59,31);
  }

.franklin_output_NoFormat pre {  
    margin          : 0;
    padding         : 0;
    line-height     : 1.35;
    background-color: rgb(1, 59,31);
}

.franklin_output_NoFormat pre code{  
    margin          : 0 !important;
    padding         : 0 !important;
    border          : none;
    background-color: rgb(1, 59,31);
}

/* NoFormat for Mixed */

.mixed_output_NoFormat{  
    font-family     : "Consolas";
    font-size       : 95%;
    color           : #DCDCDC;
    border          : none;
    background-color: rgb(1, 59,31);
    margin          : 0;
    padding         : 0;
}

.mixed_output_NoFormat pre{
  line-height: 1.35;
  color      : #DCDCDC;
  font-size  : 100%;
  margin     : 0;
  padding    : 0;
}

.mixed_output_NoFormat pre code{
  font-size       : 95%;
  margin          : 0 !important;
  padding         : 0 !important;
  border          : none;
  background-color: rgb(1, 59,31);
}



/* Inline for julia_repl and franklin_output - adding margins and paddings  */
.mixed_output_inline{
    color           : #DCDCDC;
    font-family     : "Consolas";    
    background-color: rgb(1, 59,31);

    padding-left  : 1em;
    padding-top   : 0.5em;
    padding-bottom: 1em;
    
    margin-top   : 0;
    margin-bottom: 0;
  }

  

  /* ============================ 
        OUTPUT BOX for Tabs hidden
  ============================ */ 
          
  
  /* COLLAPSABLE OUTPUT BOX*/
  .output_box{
    margin : 0;
    padding: 0;
  }

  .output_box details > summary{  
    width           : max-content; max-width: 90%;
    padding-left    : 10px;
    padding-right   : 10px;
    background-color: #3f6b4b;
    cursor          : pointer;
    color           : #ffffff;
    box-shadow      : 3px 3px 4px black;
    text-indent     : 0;
  }
  
  .output_box details[open] > summary {
    width           : max-content; max-width: 90%;
    padding-left    : 10px;
    padding-right   : 10px;
    background-color: #3f6b4b;
    border          : #282c34;
    border-width    : 1px;
    border-style    : solid;
       
  }
  
  .output_box{
    padding-top   : 0.5em;
    padding-bottom: 1em;
    margin-top    : 0em;
    margin-bottom : 1em;
  } 
  
  

    
  
 /* ================================================================= 
                      BASIC FORMAT FOR OUTPUTS
  ================================================================= */ 
  

.code_NoFormat{    
    line-height     : 1.45;
    font-size       : 95%;
    margin          : 0;
    padding         : 0;
    background-color: rgb(0, 16, 41);
  }

.code_NoFormat pre{       
    margin          : 0;
    padding         : 0;
    background-color: rgb(0, 16, 41);
}

.code_NoFormat pre code{          
    font-family     : "Cascadia Mono";       /* Fira Mono */
    margin          : 0 !important;
    padding         : 0 !important;
    border          : none;
    background-color: rgb(0, 16, 41);
}

.code_NoFormat p{  
    padding: 0;
    margin : 0;
  }

.code_inline{  
    background-color: rgb(0, 16, 41);

    padding-left  : 1em;
    padding-top   : 0.5em;
    padding-bottom: 1em;
    
    margin-top   : 0;
    margin-bottom: 0;
  }


  
  
  /* ============================ 
          CODE BOX is for a TAB hidden 
  ============================ */ 

.code_box{
  margin : 0;
  padding: 0;
}
.code_box details > summary{  
  width           : max-content;  max-width : 90%;
  padding-left    : 10px;
  padding-right   : 10px;
  background-color: rgb(63,99,136);
  cursor          : pointer;
  color           : #ffffff;
  box-shadow      : 3px 3px 4px black;
  text-indent     : 0;
}

.code_box details[open] > summary {
  width           : max-content; max-width: 90%;
  padding-left    : 10px;
  padding-right   : 10px;
  background-color: rgb(63,99,136);    
  border          : #282c34;
  border-width    : 1px;
  border-style    : solid;
     
}

.code_box{
  padding-top   : 0em;
  padding-bottom: 0em;
  margin-top    : 0em;
  margin-bottom : 1em;
} 
 



 /* ============================ */
/*          FOR MULTIPLE TABS MODALS     */
/* ============================ */
.hide_tab{
  padding-top   : 0em;
  padding-bottom: 0em;
  margin-top    : 0em;
  margin-bottom : 1em;
}

.hide_tab > details > summary {  
  width: 30px; max-width: 90%;  
  padding-left: 11px; 
  padding-right: 0px;
  padding-bottom: 0px;
  background-color:  rgb(63,99,136);   
  cursor: pointer;
  color: #ffffff;
  text-indent:0;  
  border:#282c34; 
  border-width:1px;  
  border-style:solid;   
}

.hide_tab > details[open] > summary {
  position:absolute;
  width: 35px; max-width: 90%;      
  height:1.96em;  
  padding-bottom: 0px;
  padding-top: 3px;   
  padding-left: 12px;  
  padding-right: 5px;   
  background-color: rgb(63,99,136);
  border:#282c34; 
  border-width:1px;  
  border-style:solid; 
  border-bottom: none;  
}


  
  /* ============================
      DEALING WITH TABS, FOR MODALS WITH ONLY OUTPUT OR ONLY CODE
  ============================*/

.tab_wrapper{
  width  : 100%;
  display: inline-block;  
  }


.tab_wrapper .tab_code_links{
  background-color: rgb(0, 16, 41);}


.tab_wrapper .tab_code_links .tablink{  
  background-color: rgb(63,99,136);
  color           : white;
  float           : left;
  border          : 1px solid black;
  outline         : none;
  cursor          : pointer;
  padding         : 2px 20px;  
  width           : max-content;
  height          : auto;
}

.tab_wrapper .tab_code_links .tablink.first_tab{ padding-left: 54px;}
.tab_wrapper .tab_code_links .tablink.active{    font-weight:500; background-color:rgba(82, 127, 173, 0.836);   }
.tab_wrapper .tab_code_links .tablink:hover{     background-color:rgba(82, 127, 173, 0.836); }

  
.tab_wrapper .tabcontent{    
  background-color: rgb(0, 16, 41);
  display         : none;
  width           : 100%;
  float           : left;
  margin          : 0;
  padding         : 0;
}

.tab_wrapper .tabcontent.active{  display: block;}




/* wrappers in modals */

.code_in_modal{  
  background-color: rgb(0, 16, 41);
  padding-left  : 1em;
  padding-top   : 0.5em;
  padding-bottom: 1em;
  margin-top    : 0;
  margin-bottom : 0;
}


  
.output_in_modal{  
    background-color: rgb(1, 59,31);    
  }



/* ============================
      ADDING IMAGES AS OUTPUTS
  ============================*/
/* COLLAPSIBLE OUTPUT WITH IMGS */
.img_output{
  text-indent:0;
  margin:0;
  padding:0;  
  background-color: rgba(30,30,30,255);  
}  

.img_output_in_modal{
  text-indent:0;
  margin:0;
  padding:0;  
  background-color: rgba(30,30,30,255);  
}  




.sign_output{ 
  color:white;  
  width: 100%; max-width: 100%;
  height:auto;  
  padding-bottom: 0px;
  padding-top: 0px;   
  padding-left: 12px;  
  padding-right: 12px;   
  background-color:  #3f6b4b;
  border:#282c34; 
  border-width:1px;    
  border-style:solid;  
  margin-bottom:0px;
  padding-top:0em;
}

.outputmodal_container{   
    padding:0;
  margin:0;  
}

  




/* .img_output{
color:white;
text-indent:0;
margin-top:-15px;
margin-bottom:0px;
}

.img_output details > summary {  
width: max-content; max-width: 90%;
height:auto;
padding-left: 10px;  
padding-right: 10px;  
color: white;
background-color:  #3f6b4b;
border: none;  
margin: 0;
box-shadow: 3px 3px 4px black;
cursor: pointer;  
}


.img_output details[open] > summary {
width: max-content; max-width: 90%;
padding-left: 10px;  
padding-right: 10px;  
background-color:  #3f6b4b;  
border:#282c34; 
border-width: 1px; 
color:white;
border-style:solid;
}


.img_output details > p {
border-radius: 0 0 0px 0px;
background-color: rgba(30,30,30,255);
padding: 10px 6px 10px 6px;
margin-bottom: 22px;
margin-top: 0px;
} */


  
/* ============================ */
/*          COLLAPSE TABS - HIDE BUT FOR OUTPUTS    */
/* ============================ */

/* FOR ADDING A SIGN WITH OUTPUT IN TABS */
/* 
.hide_output  > details > summary {
  width: 30px; max-width: 90%;  
  padding-left: 11px; 
  padding-right: 0px;
  padding-bottom: 0px;
  background-color:  #3f6b4b;
  cursor: pointer;  
  color: #ffffff;
  text-indent:0;  
  border:#282c34;  
  border-width:1px;  
  border-style:solid;   
}

.hide_output  > details[open] > summary {  
  position:absolute;
  width: 35px; max-width: 90%;      
  height:1.94em;  
  padding-bottom: 0px;
  padding-top: 3px;   
  padding-left: 12px;  
  padding-right: 5px;   
  background-color:  #3f6b4b;
  border:#282c34; 
  border-width:1px;    
  border-style:solid;  
  border-bottom: none;  
}

.hide_output > details > p {
  border-radius: 0 0 0px 0px;  
  padding: 0px 0px 0px 0px;  
  margin-bottom: -1px;
}

.hide_output  > details[open] {
  margin-bottom: -0.8em;  
}

.hide_output > details {
  margin-bottom: -8px;
}
 */



/* for output in modals when there are multiple outputs */



  </style>  
<!-- <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans|Roboto|Poppins|Crimson+Text|Cardo|Ubuntu"></link> -->
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans|Crimson+Text"></link>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter|Cormorant"></link>


<style>

/* THIS CONTROLS THE GLOBAL BEHAVIOR OF THE PAGE */
html { scroll-behavior: auto; }


/* change font size */
.jumbotron, .bar_top, .navbar, .nav-item, footer, .left_bar {
  font-size: 16px;  
  font-family: "Open Sans";
} 

.franklin-content{
  font-size: 17px;
  font-family: "Open Sans";
}

h1  {font-family: "Inter"}
.name_format  {font-family: "Inter"}  
.phd_format{font-family: "Inter"}




/* content */
.franklin-content{
  /* background-color:rgb(235, 235, 235);   */
  background-color: rgb(217, 224, 231);
}

.franklin-content{  
  margin:0;
  width:100%;  
  height:100%;    
  justify-content:center;       
  text-align: justify;
  text-justify: inter-word;
  line-height: 1.65;  
  /* word-wrap: break-word; */
}


/* all header */
.jumbotron{          
  margin-bottom:0px;    
  padding-top: 42px;
  padding-bottom:2em;  
  border-bottom: #000000 solid 1px;   
  border-radius: 0;}
  
  .bar_top{padding-left:180px;}  
  .franklin-content, .jumbotron {
      padding-left: 180px;}




  footer{
        background-color:rgb(63,99,136);
        background-image: linear-gradient(to right, rgba(35,55,75,255), rgba(0, 0, 0, 1) 50%,  rgb(63,99,136));
        width: calc(100%+10px);       
        margin-left: -10px;
        padding-left: 10px;
    }

/* @media screen and (min-width: 992px) {
  html {  
    zoom: 100%;
    width:100%;
  }
} */


/* .jumbotron.jumbotron-fluid.container-fluid.bg-primary{
  background-image: url(/assets/WallpaperDog-17291225.jpg);
  background-size: cover;  
} */

/* FOR THE BODY - this changes its position*/
/* .franklin-content {   
  position:absolute;
  margin-left: 0px; 
  padding-top:0;}  */


/* ALL 
.franklin-content,.jumbotron, .bar_top, .navbar, .nav-item {
  font-family: "Segoe UI"; FONT USED by DEFAULT  BY FRANKLIN 
} */

/* HEADER + NAME
  .jumbotron, h1{
  font-family: "Raleway"; 
  font-weight: 550;  
} */

/* ALL HEADER - title of page */
/* .jumbotron {
  text-align:left;
  padding-left:20px;
} */


/* HEADER only - title of page */
/* h1 {
  text-align:left;
} */

/* FORMAT OF THE TEXT IN THE MAIN BODY */
/* section .container{
  margin-left: auto;  
} */



h2 {
  text-transform: uppercase;
  font-size:160%;
  text-align:center;  
  text-decoration: underline;  
  padding-bottom: 0.5em;  
}

h3{
  text-align:left;  
  text-transform: uppercase;  
  text-decoration: underline;/*none; */
  padding-bottom: 0.0em;
  padding-top: 0.5em;
  font-size: 120%;
  font-weight: 600;
  /* color:rgb(49, 77, 105); */
}


h4{
  text-align:left;  
  /* color: rgb(73, 115, 157);  */   
  text-decoration: underline;/*none; */
  padding-bottom: 0.0em;
  padding-top: 0.5em;
  font-size: 120%;
  font-weight: 600;
}





h5,h6{
  text-indent:0;
  line-height:0.1em;
  padding-top:0.99em;
  padding-bottom: 0.0em;  
}

section {
  margin-left:0;  
  /* font-family: "Open Sans"; */  
  padding-left: 1%;
  padding-right: 1%;
  padding-top: 1.5%;
  padding-bottom: 1.0%;
  text-align: justify;
  text-justify: inter-word;
  line-height: 1.65;
  /* text-indent: 2.5%; */
  text-indent: 0;
  font-size: 100%;
  color: black;       
}

/* section p {  margin-bottom:24px;} */




section h1 { /* this is for the title defined as latex*/
  text-indent:0;
  margin-left:0px;  
}
  
section h2 {  
  text-indent: 0%; /* space between title and text  */
  margin-bottom: 0em; /* space between title and text  */  
} 


.franklin-content ul { 
  margin-left: 0em;
  margin-top: -0.6em;
  line-height: 1.15;}

.franklin-content ul li p { 
  margin-left: 0em;
  margin-bottom: 0.6em;
  line-height: 1.35;
  text-indent:0;}

.franklin-content ol li { 
    margin-left: 2em;
    line-height: 1.15;}

ul ::marker {  
  color: rgb(48, 114, 180);
}

ol ::marker {
    color: rgb(48, 114, 180);
    font-weight: bold;
}

a.anchor {
    display: block;
    position: relative;
    top: -150px;    
    visibility: hidden;    
}




/* @media (min-width: 768px) {
  .container{  
    max-width: 70% !important;
    zoom: 100%;           
  }
  .franklin-content,.jumbotron, .bar_top, .navbar, .nav-item {
    font-size: 19px;
  } 
} */








/* @media (min-width: 50rem) {
  .main-content-wrap {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    -webkit-overflow-scrolling: touch;
    overflow-x: hidden;
    overflow-y: scroll;
  }

  .main-content {
    position: relative;
    max-width: 800px;
    margin-left: 248px;
  }
}

@media (min-width: 66.5rem) {
  .main-content {
    margin-left: calc((100% - 1064px) / 2 + 264px);
  }
}

@media (min-width: 50rem) {
  .main-header {
    padding-right: 2rem;
    padding-left: 2rem;
  }
}

@media (min-width: 50rem) {
  .main-header {
    display: flex;
    justify-content: flex-end;
    height: 60px;
    background-color: #fff;
    border-bottom: 1px solid #eeebee;
  }
}

@media (min-width: 50rem) {
  .franklin-content {
    padding-right: 2rem;
    padding-left: 2rem;
    padding-top: 2rem;
    padding-bottom: 2rem;
  }
} */



@media (max-width: 768px) {
     .franklin-content,.jumbotron, .bar_top, .navbar, .nav-item, .left_bar, .bar_top{
        font-size:80% !important;}

        h1, h2, .lead {font-size: 130%;}

     .bar_top, nav, .copy-button, .left_bar .personal_website, .py-1 .container .center-text{
      visibility:hidden; width:0;}  

    
    .franklin-content, .jumbotron {      
        padding-left: 60px !important;
        padding-right: 1% !important;}
      
    
     .left_bar{width:60px !important;}
     .left_bar img{ max-width:90%;} 
    
     
     .left_bar ul li{
      line-height:1.1 !important;
      padding-top: 30px;}

      /* .left_bar ul {padding-left:0 !important; margin-left:0}   */
      .left_bar ul {text-indent:0;}  
      
      .left_bar ul li a {width:60px !important;}  

      .left_bar ul li a img{
      width:0% !important; height:0% !important; visibility: hidden;}  
    
      /* for overflowing code */
      .col-lg-.mx-auto{     
        /* white-space: pre-wrap;  */
        overflow: auto !important;
         }
    
    

       
}

</style>
<!-- <div class="left_bar" style="color:white;">
    <div style="float:center; align-items:center; justify-content: center; height:160px; width:calc(90px * 1.55165);">
        <img src="/blog/assets/pics_html/julia_logo-dark.svg"
        style= "position:relative; width:90%; height:auto; padding-top:45px;  padding-left:10px;">     
    </div> -->

<div class="left_bar" style="color:white;">
  <span>
    <img src="/blog/assets/pics_html/dog_home.png" alt="pic" style="padding: 0px; margin:0;"
      width="180px" height=auto>
  </span>



  <!-- FOR TITLE BELOW THE PICTURE  -->
  <!-- <div style="color: rgb(63,99,136);
      font-size: 20px;
      font-weight: bold;
      text-align: center;
      text-shadow: 1px 1px 0px #fff, -1px -1px 0px #fff, 1px -1px 0px #fff, -1px 1px 0px #fff, 0px 0px 5px  #fff;">
      CONTENT
    </div> -->



  <ul>
    <li>
      <a href="/blog/index.html"><img src="/blog/assets/icons/home.png"
          style="width:15%; height:auto;opacity:0.9;padding-bottom:5px;">
        Home
      </a>
    </li>

    <li>
      <a href="/blog/list_posts/"><img src="/blog/assets/icons/pen02.png"
          style="width:15%; height:auto;opacity:0.9;padding-bottom:5px;">
        Posts
      </a>
    </li>
    <!-- <li>      
      <div style="text-indent:0;">
        <button class="modalButton">
          <img src="/blog/assets/icons/keyboard01.png" style="width:20%; height:auto; opacity:0.9;margin-bottom:-12px; margin-left:-40px; padding-right:4px;">
          Keyboard<div style="margin-left:-4px; margin-top:-3em;">Shortcuts</div>
        </button>                   
      {{insert global/allPages_keyboardShortcuts.html}}
    </div> 
    </li> -->
    <li>
      <a href="/blog/links/"><img src="/blog/assets/icons/links.png"
          style="width:15%; height:auto;opacity:0.9;padding-bottom:5px;">
        Useful Links
      </a>
    </li>    
  </ul>

  <div class="personal_website">
    <a href="https://alfaromartino.github.io"><img src="/blog/assets/icons/personal.png"
        style="width:18%; height:auto;opacity:0.9;margin-bottom:-14px; padding-right:4px">
      Personal
      <div class="second_line"> Website</div>
    </a>
  </div>


  

  <!-- {{if add_github_star}}
<a class="github-button" href="https://github.com/{{github_repo}}" data-icon="octicon-star" data-size="large" 
data-show-count="true" aria-label="Star {{title}} on GitHub">Star</a>
{{end}}       -->
</div>





<style>
.left_bar {
    z-index: 200;    
    background-image: linear-gradient(to left bottom, rgb(0, 0, 0), rgb(0, 0, 0) 10%, rgb(63, 99, 136) 80%, rgb(63, 99, 136));
    position: fixed;    
    font-family: "Inter";
    height: 100%;
    top: 0;
    left: 0;          
    font-size: 20px;
    width: 180px;
}



.left_bar ul{
list-style-type: none;
float: left;
font-size:85%;
position: relative;
padding-left: 0.8em;
padding-top: 30px;
line-height: 4.25em;
}


.left_bar li a, .left_bar .personal_website a{
color: white;
}


.left_bar a:hover, .left_bar .personal_website a:hover{
  color: rgb(160, 159, 159);  
}


.left_bar .personal_website{
  position:absolute;
  bottom:0;
  padding-bottom: 1em;
  left:12px;
  font-size:18px;
}

.left_bar .personal_website .second_line{
  margin-left:calc(30px + 6px); 
  margin-top:-0.5em;
}

</style>












<!-- CONTENT PAGES -->
    
    
<style>
/* TITLE AND NAME */
h1{
  padding-top:0.4em;
  font-size:200% !important;
  text-align:center;  
}

.name_format{    
  padding-top: 0.2em;
  /* padding-bottom: 0.3em; */
  text-decoration: none;
  font-size: 150%;
  }


.phd_format {  
  color: white;
  /* padding: -0.5em 1.0em; */
  text-decoration: none;
  font-size: 90%;
  text-align: center;    
  margin-top:-0.2em;
  margin-bottom: -0.89em;
  }

  
  .name_format a { color: white; }
  .name_format a:hover {
    color: rgb(212, 212, 212);
    color: rgb(214, 227, 240)
  }

  section a{
    color: rgb(0, 96, 192);}

  section a:hover{
    color: rgba(48, 114, 180, 0.8);}
  

/* for fixing overflowing code */
.col-lg-.mx-auto {
      /* white-space: pre-wrap;  */
      overflow: auto !important;
}

  
</style>
    <header class="text-white text-center">
  
    <div class="jumbotron jumbotron-fluid container-fluid bg-primary">
  


    <h1>Performance Improvements in Julia (Part 1): Lazy Broadcasting</h1>    
    <div class="lead"> </div>
    
    
    <div class="name_format">
      <a href="https://alfaromartino.github.io/" target="_blank" rel="noopener noreferrer">Martin Alfaro</a>
      </div>
      <div class="phd_format">PhD in Economics</div>
    
    
    

    

    <!-- {{if add_github_star}}
      <a class="github-button" href="https://github.com/{{github_repo}}" data-icon="octicon-star" data-size="large" 
      data-show-count="true" aria-label="Star {{title}} on GitHub">Star</a>
    {{end}} -->
  </div>
</header>

    
    <div class="bar_top">
  <ul>
     <li>
      <div style="text-indent:0;">
        <button class="modalButton" style="background-color: transparent; color:white; display:block; margin-bottom: -2px; padding-left:0;">
          <img src="/blog/assets/icons/keyboard01.png" style="width:auto; height:30px; opacity:0.9; padding-bottom:2px; padding-right:10px; ">
            Notation and Keyboard Shortcuts</button>
      </div>      
      <div class="kbd_shortcuts">
    <div class="modal" id="modal_bar">
        <!-- Modal content -->
        <div class="modal-content" >
            <div class="modal-header">
                <h2> NOTATION AND KEYBOARD SHORTCUTS</h2>
            </div>
            <div class="modal-body">
                <span style="color:blue; font-weight:bold;">Any code written in a script</span> is displayed in <span style="color:blue; font-weight:bold;">blue boxes</span>, 
                whereas <span style="color:rgb(63, 136, 99); font-weight:bold;">output displayed in REPL</span> is in <span style="color:rgb(63, 136, 99); font-weight:bold;">green boxes</span>. 
                Moreover, text in code representing some expression is denoted by <b>&lt;this should be replaced by some code&gt;</b>.<br><br>

                The website layout is adjusted, so that you can <b>zoom in or out on the page</b> if you find the main body's text too small or too big. <br>
                
                The following keyboard shortcuts were also incorporated to facilitate navigation.
                <br>
                <br>                

                <style type="text/css">
                    .tg {
                        border-collapse: collapse;
                        border-spacing: 0;
                    }

                    .tg td {
                        border-color: black;
                        border-style: solid;
                        border-width: 1px;
                        overflow: hidden;
                        padding: 10px 12px;
                        word-break: normal;
                    }

                    .tg th {
                        border-color: black;
                        border-style: solid;
                        border-width: 1px;
                        font-weight: normal;
                        overflow: hidden;
                        padding: 10px 5px;
                        word-break: normal;
                    }

                    .tg .tg-80zn {
                        background-color: rgba(63, 99, 136, 0.2);
                        border-color: #ffffff;
                        font-weight: bold;
                        text-align: center;
                        vertical-align: top
                    }

                    .tg .tg-esg4 {
                        background-color: #ebebeb;
                        border-color: #ffffff;
                        font-weight: bold;
                        text-align: right;
                        vertical-align: top
                    }

                    .tg .tg-8jgo {
                        border-color: #ffffff;
                        text-align: left;
                        vertical-align: top
                    }

                    .tg .tg-ofj5 {
                        border-color: #ffffff;
                        text-align: center;
                        vertical-align: top
                    }
                </style>

                <table class="tg" style="margin-left: auto;  margin-right: auto;">
                    <thead>
                        <tr>
                            <th class="tg-80zn">Action</th>
                            <th class="tg-80zn">Keyboard Shortcut</th>
                        </tr>
                    </thead>
                    <tbody>  
                        <tr>
                            <td class="tg-8jgo">Open All Codes and Outputs in a Post</td>
                            <td class="tg-ofj5"><kbd>Ctrl + 🠙</kbd></td>
                        </tr>
                        <tr>
                            <td class="tg-8jgo">Close All Codes and Outputs in a Post</td>
                            <td class="tg-ofj5"><kbd>Ctrl + 🠛</kbd></td>
                        </tr>                      
                        <tr>
                            <td class="tg-8jgo">Close Any Popped Up Window (like this one)</td>
                            <td class="tg-ofj5"><kbd>Esc</kbd></td>
                        </tr>
                        <tr>
                            <td class="tg-8jgo">Previous Post</td>
                            <td class="tg-ofj5"><kbd>Ctrl + 🠘</kbd></td>
                        </tr>
                        <tr>
                            <td class="tg-8jgo">Next Post</td>
                            <td class="tg-ofj5"><kbd>Ctrl + 🠚</kbd></td>
                        </tr>
                        <tr>
                            <td class="tg-8jgo">List of Sections in a Post</td>
                            <td class="tg-ofj5"><kbd>Ctrl + x</kbd></td>
                        </tr>
                        <tr>
                            <td class="tg-8jgo">List of Keyboard Shortcuts</td>
                            <td class="tg-ofj5"><kbd>Ctrl + z</kbd></td>
                        </tr>
                    </tbody>
                </table>
                <br>                
            </div>
        </div>
    </div>





    <style>
        .kbd_shortcuts {
            color: black;
            font-size: 16px;
            line-height: 1.55;            
            list-style-type: none;
            position: relative;
            padding: 0;                
        }

        .kbd_shortcuts kbd {
            font-size: 14px;}

        
                    
        .kbd_shortcuts .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 350; /* Sit on top */            
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */  
            overflow: auto; /* Enable scroll if needed */  
            background-color: transparent;
            padding-top:48px;             
            padding-left: 180px;
            
        }
            
        .kbd_shortcuts .modal-content {
            background-color: rgb(207, 218, 228); /* rgb(235, 235, 235); */
            max-width: 90%;
            height: max-content; max-height: 90%;
            margin:0; padding:0;            
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
        }


        .kbd_shortcuts .modal-body {
            margin-left: 8px;            
            text-align: left;
            
            padding-top: 8px;
            padding-bottom: 2px;
            overflow: auto;            
        }


        .kbd_shortcuts .modal-header {
            padding: 0; 
            margin:0;           
            color: white;
            width: 100%;            
            background-color: rgb(63,99,136)
        }

        .kbd_shortcuts .modal-header h2 {
            padding-top: 16px;
            font-size: 20px;
            font-weight: bold;
            width: 100%;
            text-align: center;
            color:white;
            background-color: rgb(63,99,136)
        };            
        

        

        .kbd_shortcuts .modal-body p {
            padding: 0px 4px;
            text-align: justify;
            text-justify: inter-word;            
        }


        /* modal button */
        .modalButton {
            border: none;
            box-shadow: none;
            width: auto;            
            padding: 0;
            background-color: transparent;
            color: white;
            margin: 0;            
        }

        
    </style>
    </li>
  </ul>
</div>



<style>
  /* ================================================================= 
                        TOP BAR - TO NAVIGATE SECTIONS
  ================================================================= */ 
    
  .bar_top {  
    /* background-color: rgb(0, 0, 0);   */
    background-image: linear-gradient(to right, black, rgb(0, 0, 0) 10%, rgb(63,99,136) 55%, rgb(63,99,136));
    position: fixed;  /* fixed to stay at the top */
    width: 100%;
    height:48px;
    top: 0;
    left: 0;
    padding: 8px 0px 10px 0px;
    font-size: 100%;
    z-index: 125;  
  } 
  
  .bar_top a:hover {
      color: rgb(160, 159, 159); 
  }
  
  
  .bar_top li {  
    list-style-type: none;
    float:left;
    position:relative;
    left: 160px; /* 180px; */    
    padding-left:0;    
  }
  
  .bar_top li a{   
    color: white;
  }
  
  
  
  
  /* bar topright modal (for content of the modal) */

  
  .bar_top .modal-content {      
    position: relative;
    width: 1200px; max-width: 90%;
    height: max-content; max-height: 90%;    
  }
  
  
  .bar_top .modal-body .row{ 
    margin-left: 0;    
    margin-right: 0;  
  }
  
  .bar_top .modal-body .column {
    margin: 0px auto;    
  }
  
  .bar_top .modal-body ul li{ 
    margin-left: 0em;        
    /* line-height: 1.55; */
    text-indent: -1em;   
    font-size:90%;
    line-height: 1.0;
    padding-bottom:12px;}

.bar_top .modal-body ul li a{   
    margin-left:-1em;
  }
    

.bar_top .modal-body li {  
    float:left;  
    position:relative;
    left:0px;
    right:0px;
    padding:0;  }


  /* modal button */
  .bar_top .modalButton {      
    border: none;
    margin-bottom: 24px;
    /* box-shadow: 3px 3px 4px black;   */
    box-shadow: none;  
}

/* The Close Button */
.bar_top .modalClose {    
  font-size: 0px;   
}

    
    
  </style>
      






<div class="franklin-content">
<section id="introduction" class="scrollspy section-bg-color">
  <div class="container">
    <div class="row">
      <div class="col-lg- mx-auto">
        <h2>Introduction</h2></p>
 <div class=note>  <div class=title>  <span class="note_title" style="font-weight:500;">
      <img src="/blog/assets/icons/exclamation.png" style="width:auto; height:30px;opacity:0.99;padding-bottom:4px; margin-left:-4px;">      
      Remark </span>  </div>  <div class=content>     The <strong> script used in this post</strong> can be found <a href="https://github.com/alfaromartino/blog/tree/main//assets/PAGES/03_LazyArrays/codeDownload">here</a> under the name <code>allCode.jl</code>. If you wish to run the code with the same package versions used in this post, download instead <code>allCode_withPkg.jl</code>, along with <code>Project.toml</code> and <code>Manifest.toml</code>.  </div>  </div>
<p>Readability and performance are two crucial features in coding. However, they&#39;re not always compatible, leading you to prioritize one over the other. In this post, we&#39;ll explore a tool that enables you to enhance performance without compromising readability: lazy broadcasting.</p>
<p>In programming, the term   <span style="color: rgb(73, 113, 153);"><strong> lazy</strong></span> refers to postponing the execution of some code until the result is required. The opposite is   <span style="color: rgb(73, 113, 153);"><strong> eager</strong></span>, which means executing the code as soon as the computer reads it. When it comes to broadcasting, Julia performs it eagerly by default. This post will show how lazy broadcasting can enhance performance. </p>
<p>Lazy broadcasting is useful for computing <strong> an output that requires several intermediate steps</strong>, as long as intermediate results are unimportant and we don&#39;t need to keep them. This improves performance by  <em> i)</em> avoiding memory allocations for intermediate results, <span class="footn supr">&#91;note&#93;  <span class="footn_text"> Strictly speaking, we&#39;re referring to  <em> heap allocations</em>. The concept involves several technical aspects that are not necessary for our purposes. See <a href="https://docs.julialang.org/en/v1.9/manual/performance-tips/#Measure-performance-with-&#91;@time&#93;&#40;@ref&#41;-and-pay-attention-to-memory-allocation">here</a> if you want to know why this matter for performance, and <a href="https://discourse.julialang.org/t/a-nice-explanation-of-memory-stack-vs-heap/53915">here</a> for an intuitive explanation of  <em> heap</em> and  <em> stack</em> allocations.  </span></span>  and  <em> ii)</em> combining operations into a single one, which enables Julia to perform further optimizations.</p>
<p>      </div>
    </div>
  </div>
</section>
<section id="motivating_example" class="scrollspy">
  <div class="container">
    <div class="row">
      <div class="col-lg- mx-auto">
        <h2>Motivating Example</h2></p>
<p>To facilitate the explanation, let&#39;s consider a concrete example. This is based on Economics, but <strong> don't worry if you're not an economist, as it doesn't require any specialized knowledge</strong>. </p>
<p>The goal is to compute a company&#39;s profit for a given price of its product. Profit is defined as the difference between revenue and cost. In turn, revenue is the product of price and quantity, whereas cost is the cost per unit times the quantity produced. Therefore, if our aim is to compute profits for some given prices, we need to <strong> compute quantities, revenues, and costs as intermediate steps</strong>. </p>
<p>Formally, given some price, we need to compute the quantity demanded: <a id="eq1" class="anchor"></a><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>q</mi><mrow><mo fence="true">(</mo><mi>p</mi><mo fence="true">)</mo></mrow><mo>:</mo><mo>=</mo><mn>10</mn><mo>−</mo><mn>2.1</mn><mo>×</mo><mi>p</mi></mrow><annotation encoding="application/x-tex">
q\left(p\right):=10-2.1\times p
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">q</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord mathdefault">p</span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span></span><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mord">0</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">2</span><span class="mord">.</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">p</span></span></span></span></span></p>
<p>which makes it possible to compute the revenue and costs: <a id="eq2" class="anchor"></a><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mrow><mo fence="true">(</mo><mi>q</mi><mo separator="true">,</mo><mi>p</mi><mo fence="true">)</mo></mrow><mo>:</mo><mo>=</mo><mi>q</mi><mo>×</mo><mi>p</mi></mrow><annotation encoding="application/x-tex">
r\left(q,p\right):=q\times p
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord mathdefault" style="margin-right:0.03588em;">q</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">p</span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span></span><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.7777700000000001em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">q</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">p</span></span></span></span></span> <a id="eq3" class="anchor"></a><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mrow><mo fence="true">(</mo><mi>q</mi><mo fence="true">)</mo></mrow><mo>:</mo><mo>=</mo><mn>1.1</mn><mo>×</mo><mi>q</mi></mrow><annotation encoding="application/x-tex">
c\left(q\right):=1.1\times q
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">c</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord mathdefault" style="margin-right:0.03588em;">q</span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span></span><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mord">.</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">q</span></span></span></span></span></p>
<p>providing us with the profit <a id="eq4" class="anchor"></a><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>π</mi><mrow><mo fence="true">(</mo><mi>r</mi><mo separator="true">,</mo><mi>c</mi><mo fence="true">)</mo></mrow><mo>:</mo><mo>=</mo><mi>r</mi><mo>−</mo><mi>c</mi></mrow><annotation encoding="application/x-tex">
\pi\left(r,c\right):=r-c
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">π</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">c</span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span></span><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">c</span></span></span></span></span></p>
<p>Our task at hand is to compute <span class="eqref">(<a href="#eq4">4</a>)</span>, with <span class="eqref">(<a href="#eq1">1</a>)</span>, <span class="eqref">(<a href="#eq2">2</a>)</span>, and <span class="eqref">(<a href="#eq3">3</a>)</span> as intermediate results we won&#39;t eventually need.</p>
<p>      </div>
    </div>
  </div>
</section>
<section id="comparing_approaches" class="scrollspy section-bg-color">
  <div class="container">
    <div class="row">
      <div class="col-lg- mx-auto">
        <h2>Comparing Approaches</h2></p>
<p>The following packages are required for the code in this post. Note in particular the use of <code>LazyArrays</code>, which is what allows us to use lazy broadcasting.  <div class=" code_box"> <details  open><summary> Packages for the Post  </summary> <div class="code_inline"><div class="code_NoFormat"><pre><code class="language-julia">using DataFrames, Distributions, Random, BenchmarkTools
using LazyArrays</code></pre> </div> </div>  </details></div></p>
<p>The code below generates mock data for prices. It additionally creates functions in Julia representing equations <span class="eqref">(<a href="#eq1">1</a>)</span>, <span class="eqref">(<a href="#eq2">2</a>)</span>, <span class="eqref">(<a href="#eq3">3</a>)</span>, and <span class="eqref">(<a href="#eq4">4</a>)</span>.  <div class=" code_box"> <details  open><summary> Mock Data and Functions  </summary> <div class="code_inline"><div class="code_NoFormat"><pre><code class="language-julia">Random.seed&#33;&#40;123&#41;        # setting the seed for reproducibility
price_vector             &#61; 2 .* rand&#40;1_000&#41;

quantity&#40;price&#41;          &#61; 10 - 2.1 * price
revenue&#40;quantity, price&#41; &#61; quantity * price
cost&#40;quantity&#41;           &#61; 1.1 * quantity
profit&#40;revenue, cost&#41;    &#61; revenue - cost</code></pre> </div> </div>  </details></div></p>
<p>We now compare the performance of two broadcasting approaches. The first one is the default approach, which performs broadcasting eagerly. The second one performs the broadcast lazily, which we indicate by adding the macro <code>@~</code>. <span class="footn supr">&#91;note&#93;  <span class="footn_text"> The benchmarks in this post wrap each variable into the function <code>ref&#40;x&#41; &#61; &#40;Ref&#40;x&#41;&#41;&#91;&#93;</code>. This prevents the computer from realizing that we&#39;re repeating the same calculation. Otherwise, <code>@btime</code> would directly repeat stating the result after a few iterations rather than computing it, thus distorting the comparison.  </span></span> </p>
 <div class=" hide_tab"> <details  open><summary  >  </summary>  <p></p>
 <div class="tab_wrapper">
 <div class="tab_code_links">
    <button class="tablink first_tab active" data-id=""> Eager Broadcast (default)</button>
    <button class="tablink" data-id=""> Lazy Broadcast </button>
</div><div data-id="" class="tabcontent active">
<div class="code_in_modal"><div class="code_NoFormat"><pre><code class="language-julia">function compute_profit1&#40;price&#41;
    compute_quantity &#61; quantity.&#40;price&#41;
    compute_revenue  &#61; revenue.&#40;compute_quantity, price&#41;
    compute_cost     &#61; cost.&#40;compute_quantity&#41;
    
    profit.&#40;compute_revenue, compute_cost&#41;     
end

@btime compute_profit1&#40;ref&#40;&#36;price_vector&#41;&#41;;</code></pre> </div></div> 
<div class="output_in_modal"><div class="sign_output">Output in REPL </div>  <div class="mixed_output_inline"><div class="franklin_output_NoFormat"><pre><code class="plaintext code-output">  1.070 μs (4 allocations: 31.75 KiB)
</code></pre> </div></div> </div> 
 </div><div data-id="" class="tabcontent">
<div class="code_in_modal"><div class="code_NoFormat"><pre><code class="language-julia">function compute_profit2&#40;price&#41;
    compute_quantity &#61; @~ quantity.&#40;price&#41;
    compute_revenue  &#61; @~ revenue.&#40;compute_quantity, price&#41;
    compute_cost     &#61; @~ cost.&#40;compute_quantity&#41;
    
    profit.&#40;compute_revenue, compute_cost&#41;
end

@btime compute_profit2&#40;ref&#40;&#36;price_vector&#41;&#41;;</code></pre> </div></div> 
<div class="output_in_modal"><div class="sign_output">Output in REPL </div>  <div class="mixed_output_inline"><div class="franklin_output_NoFormat"><pre><code class="plaintext code-output">  233.333 ns (1 allocation: 7.94 KiB)
</code></pre> </div></div> </div> 
 </div></div>
<p>  </p></details></div><br>
<p>As 1 μs is 1,000 ns, the lazy approach is faster. This occurs because the default broadcasting performs eager computations. Thus, <code>compute_profit1</code> stores the results for quantities, revenue, and cost, and then computes the profit with those results. The procedure ends up performing 4 allocations: three for the intermediate steps, and one for the output of interest &#40;i.e., profit&#41;. </p>
<p>In contrast, <code>compute_profit2</code> indicates Julia that quantities, revenue, and cost should be calculated lazily. It&#39;s like saying to Julia: &quot;do not compute anything at this point, let me only describe the operation involved&quot;. This allows Julia to avoid the allocations for the intermediate results, fuse all the operations into a single one, and provide the profit as the outcome. This explains why we&#39;ve reduced 4 allocations to 1, where the only allocation is storing the vector of profits and hence is unavoidable. </p>
 <div class=note>  <div class=title>  <span class="note_title" style="font-weight:500;">
      <img src="/blog/assets/icons/exclamation.png" style="width:auto; height:30px;opacity:0.99;padding-bottom:4px; margin-left:-4px;">      
      Remark </span>  </div>  <div class=content>     Notice that the allocations would&#39;ve occurred even if we hadn&#39;t stored the results in variables. This is because any expression that relies on broadcasting allocates, even if the final result is a scalar &#40;which does not allocate&#41;. The following example demonstrates this.</p>
<p> <div class=" hide_tab"> <details  open><summary  >  </summary>  <p></p>
 <div class="tab_wrapper">
 <div class="tab_code_links">
    <button class="tablink first_tab active" data-id=""> Eager Broadcast (default)</button>
    <button class="tablink" data-id=""> Lazy Broadcast </button>
</div><div data-id="" class="tabcontent active">
<div class="code_in_modal"><div class="code_NoFormat"><pre><code class="language-julia">x        &#61; &#91;2,3,4&#93;
eager&#40;x&#41; &#61; sum&#40;x .* x .* log.&#40;x&#41;&#41;

@btime eager&#40;ref&#40;&#36;x&#41;&#41;</code></pre> </div></div> 
<div class="output_in_modal"><div class="sign_output">Output in REPL </div>  <div class="mixed_output_inline"><div class="franklin_output_NoFormat"><pre><code class="plaintext code-output">  30.955 ns (1 allocation: 80 bytes)
</code></pre> </div></div> </div> 
 </div><div data-id="" class="tabcontent">
<div class="code_in_modal"><div class="code_NoFormat"><pre><code class="language-julia">x       &#61; &#91;2,3,4&#93;
lazy&#40;x&#41; &#61; sum&#40;@~&#40;x .* x .* log.&#40;x&#41;&#41;&#41;

@btime lazy&#40;ref&#40;&#36;x&#41;&#41;</code></pre> </div></div> 
<div class="output_in_modal"><div class="sign_output">Output in REPL </div>  <div class="mixed_output_inline"><div class="franklin_output_NoFormat"><pre><code class="plaintext code-output">  29.819 ns (0 allocations: 0 bytes)
</code></pre> </div></div> </div> 
 </div></div>
<p>  </p></details></div><br>  </div>  </div>
<p>      </div>
    </div>
  </div>
</section>
<section id="when_to_use_lazy_broadcasts" class="scrollspy">
  <div class="container">
    <div class="row">
      <div class="col-lg- mx-auto">
        <h2>When to Use Lazy Broadcasts?</h2> </p>
<p>A lazy approach is only preferred when the intermediate results aren&#39;t needed for any other computation. If, for instance, quantities are necessary to computer other results besides profits, storing them will likely improve performance—the detrimental effect of storing the result would be more than compensated for by avoiding the computation of quantities multiple times. </p>
<p>Furthermore, lazy broadcasting should only be applied to performance-critical parts of the code, or when a function is repeatedly used across your projects. Otherwise, the time spent on writing the code might not be worth the performance gain.</p>
<p>Lazy broadcasting could also be useful if you have a tight loop or, in the same vein, for computations on subgroups in a DataFrame. To illustrate this, let&#39;s consider a hypothetical dataset containing information on companies, spanning several years and countries. In particular, let&#39;s create some mock data for years 2000-2020 and 50 countries, each with 10,000 companies. This results in a DataFrame with 10,500,000 observations. If you&#39;re interested in seeing how the data was constructed, you can open the code below.</p>
 <div class=" code_box"> <details  closed><summary> Mock Data  </summary> <div class="code_inline"><div class="code_NoFormat"><pre><code class="language-julia">#80-20 Pareto Rule within country-year
prices_random&#40;nr_firms, nr_countries&#41; &#61; &#91;rand&#40;Pareto&#40;log&#40;4, 5&#41;&#41;, nr_firms&#41; for _ in 1:nr_countries&#93; 

function generate_yearly_data&#40;year, nr_firms, nr_countries&#41;
    revenue &#61; prices_random&#40;nr_firms, nr_countries&#41;
    dff     &#61; DataFrame&#40;country&#61;1:nr_countries, price &#61; revenue&#41;
    dff     &#61; flatten&#40;dff,2&#41;

    dff.firm  &#61; repeat&#40;1:nr_firms, outer &#61; nr_countries&#41;
    dff.year  .&#61; year
    return dff
end


function generate_data&#40;nr_years, nr_firms, nr_countries&#41;    
    dff &#61; generate_yearly_data&#40;2000, nr_firms, nr_countries&#41;
    for year in 2001:nr_years-1&#43;2001
        append&#33;&#40;dff, generate_yearly_data&#40;year, nr_firms, nr_countries&#41;&#41; 
    end   

    return select&#33;&#40;dff, &#91;:year, :country, :firm, :price&#93;&#41;
end

dff &#61; generate_data&#40;nr_years, nr_firms, nr_countries&#41; #it generates the DataFrame</code></pre> </div> </div>  </details></div>
<p>Ultimately, what matters is that the DataFrame looks like the following.</p>
 <div class=" output_box"> <details  open><summary> Output in REPL  </summary> <div class="mixed_output_inline"><div class="mixed_output_NoFormat"><span style="color:rgb(32, 198, 121) !important; font-weight: bold;">julia&gt</span> dff&#91;1:5,:&#93; <br/> <pre><code class="plaintext code-output">5×4 DataFrame
 Row │ year   country  firm   price
     │ Int64  Int64    Int64  Float64
─────┼────────────────────────────────
   1 │  2000        1      1  2.75317
   2 │  2000        1      2  4.54952
   3 │  2000        1      3  2.38347
   4 │  2000        1      4  1.35309
   5 │  2000        1      5  1.72773
</code></pre> </div></div>  </details></div>
<p>Suppose we want to compute the mean profit for each country and year. This requires performing the same calculation <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mi>r</mi><mi mathvariant="normal">_</mi><mi>c</mi><mi>o</mi><mi>u</mi><mi>n</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>e</mi><mi>s</mi><mo>×</mo><mi>n</mi><mi>r</mi><mi mathvariant="normal">_</mi><mi>y</mi><mi>e</mi><mi>a</mi><mi>r</mi><mi>s</mi><mo>=</mo><mn>1</mn><mo separator="true">,</mo><mn>050</mn></mrow><annotation encoding="application/x-tex">nr\_countries\times nr\_years=1,050</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9695199999999999em;vertical-align:-0.31em;"></span><span class="mord mathdefault">n</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathdefault">c</span><span class="mord mathdefault">o</span><span class="mord mathdefault">u</span><span class="mord mathdefault">n</span><span class="mord mathdefault">t</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">i</span><span class="mord mathdefault">e</span><span class="mord mathdefault">s</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.74056em;vertical-align:-0.31em;"></span><span class="mord mathdefault">n</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mord mathdefault">e</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">s</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8388800000000001em;vertical-align:-0.19444em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">0</span><span class="mord">5</span><span class="mord">0</span></span></span></span> times. In contrast to the previous example, each firm&#39;s profit is not of interest anymore, and so we can avoid storing this result too. The following comparison shows an eager and a lazy broadcast approach for computing the mean profit. </p>
 <div class=" hide_tab"> <details  open><summary  >  </summary>  <p></p>
 <div class="tab_wrapper">
 <div class="tab_code_links">
    <button class="tablink first_tab active" data-id=""> Eager Broadcast (default)</button>
    <button class="tablink" data-id=""> Lazy Broadcast </button>
</div><div data-id="" class="tabcontent active">
<div class="code_in_modal"><div class="code_NoFormat"><pre><code class="language-julia">dfg &#61; groupby&#40;dff,&#91;:country,:year&#93;&#41;

function average_profit1&#40;price&#41;
    compute_quantity &#61; quantity.&#40;price&#41;
    compute_revenue  &#61; revenue.&#40;compute_quantity, price&#41;
    compute_cost     &#61; cost.&#40;compute_quantity&#41;    
    compute_profit   &#61; profit.&#40;compute_revenue, compute_cost&#41;

    mean&#40;compute_profit&#41;
end

@btime transform&#40;ref&#40;dfg&#41;, ref&#40;:price&#41; &#61;&gt; average_profit1 &#61;&gt; :profit&#41;</code></pre> </div></div> 
<div class="output_in_modal"><div class="sign_output">Output in REPL </div>  <div class="mixed_output_inline"><div class="franklin_output_NoFormat"><pre><code class="plaintext code-output">  233.661 ms (9203 allocations: 1.10 GiB)
</code></pre> </div></div> </div> 
 </div><div data-id="" class="tabcontent">
<div class="code_in_modal"><div class="code_NoFormat"><pre><code class="language-julia">dfg &#61; groupby&#40;dff,&#91;:country,:year&#93;&#41;

function average_profit2&#40;price&#41;
    compute_quantity &#61; @~ quantity.&#40;price&#41;
    compute_revenue  &#61; @~ revenue.&#40;compute_quantity, price&#41;
    compute_cost     &#61; @~ cost.&#40;compute_quantity&#41;
    compute_profit   &#61; @~ profit.&#40;compute_revenue, compute_cost&#41;

    mean&#40;compute_profit&#41;
end

@btime transform&#40;ref&#40;dfg&#41;, ref&#40;:price&#41; &#61;&gt; average_profit2 &#61;&gt; :profit&#41;</code></pre> </div></div> 
<div class="output_in_modal"><div class="sign_output">Output in REPL </div>  <div class="mixed_output_inline"><div class="franklin_output_NoFormat"><pre><code class="plaintext code-output">  164.001 ms (794 allocations: 801.15 MiB)
</code></pre> </div></div> </div> 
 </div></div>
<p>  </p></details></div><br>
<p>      </div>
    </div>
  </div>
</section>

<footer class="py-1">    
    <!-- <p class="m-0"> -->
    <div class="container">
       <span class="left-text"><a href="/blog/PAGES\02_worldHeatmaps" class="prevPage"><img src="/blog/assets/icons/prev-page.png"
        style="width:40px; height:auto;opacity:0.9;padding-bottom:5px;"> Previous Post</a></span>
       <span class="right-text"><a href="/blog/PAGES\01_packageUpdate" class="nextPage">Next Post <img src="/blog/assets/icons/next-page.png"
        style="width:40px; height:auto;opacity:0.9;padding-bottom:5px;"></a>    </span>              
    <span class="center-text">  © Martin Alfaro <br>Website Last Modified on June 14, 2023 </span>  
  </div>
<!-- </p>  -->
</footer>



<style>


footer{font-family: "Inter";}

footer .container {  
  width: 100%;
  margin-top:0.6em;
  margin-bottom:0.5em;
  overflow: hidden;
  text-align:center;
  align-items: center;
  justify-content:center;
  color:white;  
}

footer .center-text {  
  /* float:center;   */
  text-align:center;
  
}

footer .left-text {
  float: left;
  /* text-align: left; */
}

footer .right-text {
  float: right;
  /* text-align: right; */
}

footer a {
  color: white;
}

footer a:hover {
  color: white;
  opacity:0.9;  
  text-decoration: none;
}
/* style="position:relative; display:flex; justify-content:left; align-items: left; text-align:left; color:white; left:0; padding-left:6px;"> */
/* style="position:relative; display:flex; justify-content:right; align-items: right; text-align:right;  color:white; right:0; padding-right:6px;">  */
</style>

<script>
  // Get page URLs
const prevPageURL = document.querySelector(".prevPage").href;
const nextPageURL = document.querySelector(".nextPage").href;

// Add click and keyboard event listeners
document.querySelector(".prevPage").addEventListener("click", goToPrevPage);
document.querySelector(".nextPage").addEventListener("click", goToNextPage);
document.addEventListener("keyup", (e) => {
  if (e.key === "ArrowLeft" && e.ctrlKey) {
    goToPrevPage();
  } else if (e.key === "ArrowRight" && e.ctrlKey) {
    goToNextPage();
  }
});

// Click handler functions 
function goToPrevPage() {
  window.location = prevPageURL; 
}
function goToNextPage() {
  window.location = nextPageURL; 
}


</script>




</div><!-- CONTENT ENDS HERE -->

<!-- ADDED BY FRANKLIN -->
  
      



  
  
      <script src="/blog/libs/highlight/highlight.pack.js"></script>
<!-- <script src="/blog/libs/highlight/julia.highlight.js"></script> -->
<script>hljs.initHighlightingOnLoad();hljs.configure({tabReplace: '    '});</script>

  
  <script src="/blog/libs/simple-scrollspy.min.js"></script>
  <script>
  window.onload = function () {
    scrollSpy('#navbarResponsive', {
      sectionClass: '.scrollspy',
      menuActiveTarget: '.nav-link',
      offset: 100
    })
  }
  </script>
  </body>
</html>



<!-- 
#################################################
# FOR ALL PAGES
################################################# 
-->

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" integrity="sha384-w1Q4orYjBQndcko6MimVbzY0tgp4pWB4lZ7lr30WKz0vr/aWKhXdBNmNb5D92v7s" crossorigin="anonymous"></script> 
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>



<!-- FOR ICONS -->
<script async defer src="https://buttons.github.io/buttons.js"></script>




<!-- FOR MODALS and TABS-->

<script>
  
    const btns = document.getElementsByClassName('modalButton');
    const modals = document.getElementsByClassName('modal');
  
    [...btns].forEach((btn, ind) => {
      btn.onclick = () => (modals[ind].style.display = 'block');
    });
  
  
  // Close the modal when user clicks outside of it
  window.addEventListener('click', function(event) {
  const modals = document.getElementsByClassName('modal');
  const modalContents = document.getElementsByClassName('modal-content');
  const modalButtons = document.getElementsByClassName('modalButton');
  for (let i = 0; i < modals.length; i++) {
    const modal = modals[i];
    const modalContent = modalContents[i];
    const modalButton = modalButtons[i];
    if (modal.style.display === 'block' && !modalContent.contains(event.target) && !modalButton.contains(event.target)) {
      modal.style.display = 'none';
    }
  }
});

    
  document.addEventListener('keydown', function (event) {
    if (event.ctrlKey && event.key === 'z') {
      // Select the button element      
      const modal = document.getElementById('modal_bar');
      if (modal && modal.style.display === 'block') {
        modal.style.display = 'none';
      }
      else { modal.style.display = 'block'; }

      // Check if modal with id="modal_bar" is opened
    }
  });

  



 </script> 

<!-- NECESSARY TO MAKE IT WORK -->
<script> 
let handleClick = e => {
  Array.from(e.target.parentElement.parentElement.querySelectorAll(".active"), e => e.classList.remove("active")); // remove `active` class from every elements which contains him.
  e.target.classList.add("active");
  document.querySelector(`div.tabcontent[data-id*="${e.target.dataset.id}"]`).classList.add("active");
 
};

Array.from(document.getElementsByClassName("tablink"), btn => btn.addEventListener('click', handleClick, false));
</script>





<!-- FOR SETTING SAME HEIGHT of CODE and OUTPUT WITHIN A TABCONTENT -->
<script>
  let setHeight = () => {
  let tabWrappers = document.querySelectorAll('.tab_wrapper');
  tabWrappers.forEach(wrapper => {
    let tabContents = wrapper.querySelectorAll('.tabcontent');
    let maxCodeHeight = 0;
    let maxOutputHeight = 0;

    tabContents.forEach(tabContent => {
      // Temporarily show the tabContent to calculate its children's height
      let originalVisibility = tabContent.style.visibility;
      tabContent.style.visibility = 'visible';

      let originalPosition = tabContent.style.position;
      let originalDisplay = tabContent.style.display;
      tabContent.style.position = 'relative';
      tabContent.style.display = 'inline-block';

      let codeInModal = tabContent.querySelector('.code_in_modal');
      let outputInModal = tabContent.querySelector('.output_in_modal');

      if (codeInModal) {
        codeInModal.style.height = 'auto';
        let codeHeight = codeInModal.offsetHeight;
        if (codeHeight > maxCodeHeight) {
          maxCodeHeight = codeHeight;
        }
      }

      if (outputInModal) {
        outputInModal.style.height = 'auto';
        let outputHeight = outputInModal.offsetHeight;
        if (outputHeight > maxOutputHeight) {
          maxOutputHeight = outputHeight;
        }
      }

      // Restore the original position and visibility
      tabContent.style.visibility = originalVisibility;
      tabContent.style.position = originalPosition;
      tabContent.style.display = originalDisplay;
    });

    tabContents.forEach(tabContent => {
      let codeInModal = tabContent.querySelector('.code_in_modal');
      let outputInModal = tabContent.querySelector('.output_in_modal');

      if (codeInModal) {
        codeInModal.style.height = maxCodeHeight + 'px';
      }

      if (outputInModal) {
        outputInModal.style.height = maxOutputHeight + 'px';
      }
    });
  });
};

window.addEventListener('load', setHeight);
window.addEventListener('resize', setHeight);
</script>








<!-- <script> 
   OLD FOR SETTING HEIGHT OF TABCONTENT ONLY
    let setHeight = () => {
      let tabWrappers = document.querySelectorAll('.tab_wrapper');
      tabWrappers.forEach(wrapper => {
        let tabs = wrapper.querySelectorAll('.tabcontent');
        let maxHeight = 0;
        tabs.forEach(tab => {
          // Temporarily show the tab to calculate its height
          let originalVisibility = tab.style.visibility;
          tab.style.visibility = 'visible';

          let originalPosition = tab.style.position;
          let originalDisplay = tab.style.display;
          tab.style.position = 'relative';
          tab.style.display = 'inline-block';

          tab.style.height = '100%';
          let height = tab.offsetHeight;
          if (height > maxHeight) {
            maxHeight = height;
          }

          // Restore the original position and visibility
          tab.style.visibility = originalVisibility;
          tab.style.position = originalPosition;
          tab.style.display = originalDisplay;
        });
        tabs.forEach(tab => {
          tab.style.height = maxHeight + 'px';
        });
      });
    };

  window.addEventListener('load', setHeight);
  window.addEventListener('resize', setHeight);
</script> -->


<script>
  // Get all the tab wrappers on the page
  var tabWrappers = document.getElementsByClassName("tab_wrapper");

  // Iterate over the tab wrappers
  for (var i = 0; i < tabWrappers.length; i++) {
    var tabWrapper = tabWrappers[i];
    var buttons = tabWrapper.getElementsByClassName("tablink");
    var tabContents = tabWrapper.getElementsByClassName("tabcontent");

    // Set the data-id values for each button and tab content
    for (var j = 0; j < buttons.length; j++) {
      var button = buttons[j];
      var tabContent = tabContents[j];
      var dataId = "tab" + (i + 1) + "_" + (j + 1); // Create the data-id value

      // Set the data-id attribute for the button
      button.setAttribute("data-id", dataId);

      // Set the data-id attribute for the tab content
      tabContent.setAttribute("data-id", dataId);
    }
  }
</script>

<!-- to close all the elements in a class "details" using "Ctrl" + "Up Arrow" -->
<script>
document.addEventListener("keydown", function(event) {
  if (event.code === "ArrowUp" && event.ctrlKey) {    
    var details = document.getElementsByTagName("details");
    for (var i = 0; i < details.length; i++) {
        details[i].open = false;
    }
  }
});
</script>



<!-- to open all the elements in a class "details" using "Ctrl" + "Down Arrow" -->
<script>
    document.addEventListener("keydown", function(event) {
  if (event.code === "ArrowDown" && event.ctrlKey) {
    var details = document.getElementsByTagName("details");
    for (var i = 0; i < details.length; i++) {
        details[i].open = true;
    }
  }
});



// // USER- TO USE ESCAPE TO CLOSE IT
window.onkeydown = function(event) {
        if (event.key == 'Escape') {
            for(let modal of modals) {
                modal.style.display = 'none';
            }
        }
    }
</script>
  





<!-- FOR PICS -->
<style>

    /* for collapsible pics  */
.pic_drop_green{    
  padding-top: 1em;
  padding-bottom: 1em ;
  }

.pic_drop_green details > summary {  
  color:white;
  display:inline-block;
  width: auto;
  cursor: pointer;
  
  padding: 0px 6px;
  margin: 0;
  
  border-width: 1px; 
  border-style:solid;
  box-shadow: 3px 3px 4px black;

  /* list-style: none;   */  
  background-color: #3f6b4b;
}


.pic_drop_green details[open] > summary {
  width: auto;
  padding: 0px 6px;
  
  border: #a8a8a8;  
  border-width: 1px;   
  border-style:solid;

  color:white;
  background-color: #3f6b4b;
  
  
}

.pic_drop_green details > p {
  display:block;
  width:auto;    
  padding: 0;
  margin: 0;  
}


</style>



<!-- 
#################################################
# FOR EACH SPECIFIC PAGE
#################################################
 -->




 <!-- FOR NAVIGATION-->
       
    
<!-- to make it visible as default change line 9 by
<div class="collapse show navbar-collapse" id="collapsibleNavbar"> -->


<!-- unline the ABOVE, this has OFFSET, SO THAT WE MOVE UP OR DOWN WHEN IT GOES TO THE LINK (in case the header covers the title of the subsection)-->
<nav class="navbar navbar-dark">
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#collapsibleNavbar">
    <span class="navbar-toggler-icon"></span>
    <a class="navbar-brand">Performance Improvements in Julia (Part 1): Lazy Broadcasting</a>
  </button>
  <div class="collapse navbar-collapse" id="collapsibleNavbar">
    <ul class="navbar-nav">
      
      <li class="nav-item">
        <a class="nav-link" href="#introduction" data-offset="-40">Introduction</a>
      </li>
      
      <li class="nav-item">
        <a class="nav-link" href="#motivating_example" data-offset="-40">Motivating Example</a>
      </li>
      
      <li class="nav-item">
        <a class="nav-link" href="#comparing_approaches" data-offset="-40">Comparing Approaches</a>
      </li>
      
      <li class="nav-item">
        <a class="nav-link" href="#when_to_use_lazy_broadcasts" data-offset="-40">When to Use Lazy Broadcasts?</a>
      </li>
      
    </ul>
  </div>
</nav>

<script>
  $(function () {
    // Add click event listener to nav links
    $('.nav-link').on('click', function (event) {
      event.preventDefault();
      var target = $(this.getAttribute('href'));
      var offset = parseInt($(this).data('offset'), 10) || 0;

      if (target.length) {
        // Set the scroll position without animation
        $('html, body').scrollTop(target.offset().top + offset);
      }
    });

    $(document).click(function (event) {
      var clickover = $(event.target);
      var _opened = $(".navbar-collapse").hasClass("navbar-collapse collapse show");
      if (_opened === true && clickover.closest('.navbar').length === 0) {
        $(".navbar-collapse").collapse('hide');
      }
    });
  });
</script>



<!-- ===========================  
    TO CLOSE IT
=============================== -->


<!-- PRESSING ANYWHERE TO CLOSE THE SECTION BAR -->
<script>
  $(function () {
    $(document).click(function (event) {
      var clickover = $(event.target);
      var _opened = $(".navbar-collapse").hasClass("navbar-collapse collapse show");
      if (_opened === true && clickover.closest('.navbar').length === 0) {
        $(".navbar-collapse").collapse('hide');
      }
    });
  });
</script>


  

<!-- PRESSING ESC TO CLOSE THE SECTION BAR and ctrl+x to open it -->
<script>
document.onkeydown = function(evt) {
  if ((evt.keyCode == 27) || (evt.key === 'x' && evt.ctrlKey === true)){
    $(".navbar-collapse").collapse('hide');
  }
  if (evt.key === 'x' && evt.ctrlKey === true) {
    $(".navbar-collapse").collapse('show');
  }
};
</script>


<style>






  /* ================================================================= 
                      NAVIGATION BAR
================================================================= */ 
.navbar{
  z-index: 175;
  position:fixed;
  top:0;
  right:0;
  color: white;
  border: none;
  padding: 0px 0px;
  display: block;
  }

.navbar-toggler {
  position:relative;
  background-color: rgb(63,99,136);
  border-radius: 0;
  border:none;
  height:48px;
  font-size:100%;
}

.navbar-brand {  
  font-size:100%;
  padding-right:2px;  
}


.navbar-nav{
  position:fixed;  
  right:0;
  padding-left:22px; 
  padding-right:10px;   
  padding-top:8px; 
  /* background-color: rgb(63,99,136);   */
  background-image: linear-gradient(to bottom, rgb(63,99,136) 30%,  black );
  height:100%;    
  width:300px;
  font-size:100%;
}

.navbar-nav ul{
  visibility: visible;  
}


.nav-item a{  
    color: white !important;    
}
.nav-item a:hover{
  color: rgb(160, 159, 159) !important;
}

#collapsibleNavbar{
  transition: none;
}


</style>




<!-- <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans|Roboto|Poppins|Crimson+Text|Cardo|Ubuntu"></link> -->

<style>


@media (max-width: 850px){
     .franklin-content,.jumbotron, .left_bar{
        font-size:90% !important;}

        .franklin-content{
        font-size:100% !important;}

      .index_container,  .index_container section{font-size: 100%;}
      

      .index_container{
        padding-left:1%;
        padding-right:1%;              
      }

      h1 {font-size: 180%; padding-top:0.5em ;padding-bottom:0em; }
      h2, .lead {font-size: 110%; }
      .lead {padding-top:0em;padding-bottom: 1em;}

     .bar_top, nav, .copy-button, .left_bar .personal_website, .py-1 .container .center-text{
      visibility:hidden; width:0 !important; height:0 !important}  

      /* for fixing overflowing code */
      .col-lg-.mx-auto{     
        /* white-space: pre-wrap;  */
        overflow: auto !important;
         }   
          
    
      .jumbotron {      
        padding-left: 60px !important;
        padding-right: 1% !important;
        padding-top: 0; margin-top:0;}


        
      
      .franklin-content{
         padding-left: 0 !important;}
     
     .left_bar{      
      position:absolute;
      top: 0 ;
      left: 0 ;
      height:auto;
      background-image: none;}
     
     

      /* .left_bar ul {padding-left:0 !important; margin-left:0}   */
      .left_bar ul, .left_bar ul li {text-indent:0; padding-top:0.5em;padding-bottom:1.5em !important; height:auto;}
      
      .left_bar ul li a {width:60px !important;}  

      .left_bar img{
      width:0% !important; height:0% !important; visibility: hidden;}  
    
      
}



@media (max-height: 600px) {
     .jumbotron, .left_bar{
        font-size:90% !important;}

        .franklin-content{font-size:100% !important}

      .index_container,  .index_container section{font-size: 100%;}
      

      .index_container{
        padding-left:1%;
        padding-right:1%;              
      }

      h1 {font-size: 180%; padding-top:0.5em ;padding-bottom:0em; }
      h2, .lead {font-size: 110%; }
      .lead {padding-top:0em;padding-bottom: 1em;}

     .bar_top, nav, .copy-button, .left_bar .personal_website, .py-1 .container .center-text{
      visibility:hidden; width:0 !important; height:0 !important}  

      /* for fixing overflowing code */
      .col-lg-.mx-auto{     
        /* white-space: pre-wrap;  */
        overflow: auto !important;
         }   
          
    
      .jumbotron {      
        padding-left: 60px !important;
        padding-right: 1% !important;
        padding-top: 0; margin-top:0;}


        
      
        .franklin-content{
         padding-left: 0 !important;}
     
     .left_bar{      
      position:absolute;
      top: 0 ;
      left: 0 ;
      height:auto;
      background-image: none;}
     
     

      /* .left_bar ul {padding-left:0 !important; margin-left:0}   */
      .left_bar ul, .left_bar ul li {text-indent:0; padding-top:0em ; padding-bottom:0em !important; height:2.5em; font-size:100%;}
      
      .left_bar ul li a {width:60px !important;}  

      .left_bar img{
      width:0% !important; height:0% !important; visibility: hidden;}  
}


    @media (max-width: 850px), (max-height: 600px) {
      h2, .lead {font-size: 140%;padding-top:1em; }
      h1 {font-size: 200%}
      
    }

    @media (max-height: 600px){
          .left_bar ul, .left_bar ul li {text-indent:0; padding-top:0.0em ; padding-bottom:0em !important; height:3.2em; font-size:105%;}
        }

    @media (max-width: 850px){
      .left_bar ul, .left_bar ul li {text-indent:0; padding-top:0.5em ; padding-bottom:0em !important; height:3.5em; font-size:102%; padding-left:0.15em;}
    }  


</style>

  
<!-- COPY BUTTON -->
<script src="/blog/libs/clipboard.min.js"></script> 
<!-- http://tutsplus.github.io/clipboard/ -->

<script>
    (function(){
    
        // Get the elements.
        // - the 'pre' element.
        // - the 'div' with the 'paste-content' id.
    
        var pre = document.getElementsByTagName('pre');
    
        // Add a copy button in the 'pre' element.
        // which only has the className of 'language-' or ' hljs'(if enable highlight.js pre-render).
    
        for (var i = 0; i < pre.length; i++) {
            var tag_name = pre[i].children[0].className
                    var isLanguage = tag_name.startsWith('language-') || tag_name.endsWith(' hljs');
            if ( isLanguage ) {
                var button           = document.createElement('button');
                        button.className = 'copy-button';
                        button.textContent = 'Copy';
    
                        pre[i].appendChild(button);
            }
        };
    
        // Run Clipboard
    
        var copyCode = new Clipboard('.copy-button', {
            target: function(trigger) {
                return trigger.previousElementSibling;
        }
        });
    
        // On success:
        // - Change the "Copy" text to "Copied".
        // - Swap it to "Copy" in 2s.
        // - Lead user to the "contenteditable" area with Velocity scroll.
    
        copyCode.on('success', function(event) {
            event.clearSelection();
            event.trigger.textContent = 'copied!';
            window.setTimeout(function() {
                event.trigger.textContent = 'copy';
            }, 2000);
    
        });
    
        // On error (Safari):
        // - Change the  "Press Ctrl+C to copy"
        // - Swap it to "Copy" in 2s.
    
        copyCode.on('error', function(event) {
            event.trigger.textContent = 'Press "Ctrl + C" to copy';
            window.setTimeout(function() {
                event.trigger.textContent = 'Copy';
            }, 5000);
        });
    
    })();
    </script>

